{% extends "base.html" %}
{% block title %}Inventario{% endblock %}

{% block content %}
<main class="container mx-auto my-6 px-4 pb-12">
    <!-- Header -->
    <!-- Header -->
    <!-- Header -->
    <div class="glass-panel p-6 mb-8 animate-fade-in shadow-xl shadow-primary-900/5">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
            <div>
                <h1
                    class="text-3xl font-bold font-heading italic text-transparent bg-clip-text bg-gradient-to-r from-primary-200 to-primary-400">
                    Inventario
                </h1>
                <p class="text-canvas-400 text-sm mt-1">Control de stock y productos</p>
            </div>
            <a href="{{ url_for('inventario.agregar_producto') }}"
                class="btn-elegant btn-primary bg-primary-600 hover:bg-primary-500 text-white shadow-lg shadow-primary-500/20">
                <span class="material-symbols-outlined text-[18px]">add_box</span> Nuevo Producto
            </a>
        </div>

        <!-- Filters -->
        <div class="bg-canvas-900/40 border border-canvas-700/50 p-5 rounded-xl">
            <form method="get" class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                <div class="md:col-span-5">
                    <label
                        class="block text-xs font-semibold text-canvas-400 uppercase tracking-wider mb-2">Buscar</label>
                    <div class="relative">
                        <span
                            class="material-symbols-outlined absolute left-3 top-2.5 text-canvas-500 text-[20px]">search</span>
                        <input type="text" name="q"
                            class="form-input pl-10 focus:border-primary-500 focus:ring-primary-500"
                            placeholder="Marca, Modelo, Referencia..." value="{{ request.args.get('q', '') }}">
                    </div>
                </div>
                <div class="md:col-span-4">
                    <label
                        class="block text-xs font-semibold text-canvas-400 uppercase tracking-wider mb-2">Orden</label>
                    <div class="relative">
                        <span
                            class="material-symbols-outlined absolute left-3 top-2.5 text-canvas-500 text-[20px]">sort</span>
                        <select name="orden" id="orden"
                            class="form-input pl-10 appearance-none focus:border-primary-500 focus:ring-primary-500"
                            onchange="this.form.submit()">
                            <option value="asc" {% if orden=='asc' %}selected{% endif %}>Modelo A-Z</option>
                            <option value="desc" {% if orden=='desc' %}selected{% endif %}>Modelo Z-A</option>
                            <option value="precio_asc" {% if orden=='precio_asc' %}selected{% endif %}>Precio ascendente
                            </option>
                            <option value="precio_desc" {% if orden=='precio_desc' %}selected{% endif %}>Precio
                                descendente</option>
                            <option value="cantidad_asc" {% if orden=='cantidad_asc' %}selected{% endif %}>Cantidad
                                ascendente</option>
                            <option value="cantidad_desc" {% if orden=='cantidad_desc' %}selected{% endif %}>Cantidad
                                descendente</option>
                        </select>
                    </div>
                </div>
                <div class="md:col-span-3">
                    <button type="submit"
                        class="w-full btn-elegant btn-secondary justify-center bg-canvas-800 hover:bg-canvas-700 text-canvas-200">
                        Aplicar Filtros
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Table -->
    <div class="glass-panel p-1 overflow-hidden animate-fade-in shadow-xl shadow-primary-900/5"
        style="animation-delay: 0.1s;">
        <div class="overflow-x-auto rounded-lg">
            <table class="w-full text-sm text-left text-canvas-300">
                <thead class="text-xs text-canvas-400 uppercase bg-canvas-900/80 font-heading tracking-wider">
                    <tr>
                        <th class="px-6 py-4 font-semibold">Producto</th>
                        <th class="px-6 py-4 font-semibold">Tipo</th>
                        <th class="px-6 py-4 font-semibold">Detalles</th>
                        <th class="px-6 py-4 font-semibold text-right">Precio</th>
                        <th class="px-6 py-4 font-semibold text-center">Stock</th>
                        <th class="px-6 py-4 font-semibold">Ref / Prov</th>
                        <th class="px-6 py-4 font-semibold text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-canvas-700/50">
                    {% for producto in productos %}
                    <tr class="hover:bg-primary-500/5 transition-colors group">
                        <td class="px-6 py-4">
                            <div class="font-bold text-canvas-100 text-base">{{ producto.modelo }}</div>
                            <div class="text-xs text-primary-400 font-semibold">{{ producto.marca }}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span
                                class="px-2 py-1 bg-canvas-800 text-canvas-300 rounded text-xs border border-canvas-600">
                                {{ producto.tipo_producto }}
                            </span>
                        </td>
                        <td class="px-6 py-4 max-w-xs">
                            <p class="truncate text-canvas-400 text-xs" title="{{ producto.descripcion }}">
                                {{ producto.descripcion }}
                            </p>
                        </td>
                        <td class="px-6 py-4 text-right font-mono text-emerald-400 font-medium">
                            {{ producto.precio | currency }}
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex flex-col items-center">
                                <span
                                    class="text-lg font-bold {{ 'text-red-400' if producto.cantidad <= producto.cantidad_minima else 'text-canvas-200' }}">
                                    {{ producto.cantidad }}
                                </span>
                                <span class="text-[10px] text-canvas-500">Mín: {{ producto.cantidad_minima }}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-xs text-canvas-400">
                            <div>Ref: <span class="font-mono text-canvas-300">{{ producto.num_referencia }}</span></div>
                            <div class="mt-1 flex items-center gap-1">
                                <span class="material-symbols-outlined text-[14px]">store</span>
                                <span class="truncate max-w-[100px]"
                                    title="{{ producto.proveedor.nombre if producto.proveedor else 'N/A' }}">
                                    {{ producto.proveedor.nombre if producto.proveedor else 'N/A' }}
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div
                                class="flex items-center justify-center gap-2 opacity-80 group-hover:opacity-100 transition-opacity">
                                <a href="{{ url_for('inventario.editar_producto', id=producto.id) }}"
                                    class="p-2 rounded-lg hover:bg-canvas-700 text-canvas-400 hover:text-primary-400 transition-colors"
                                    title="Editar">
                                    <span class="material-symbols-outlined text-[20px]">edit</span>
                                </a>
                                <form action="{{ url_for('inventario.eliminar_producto', id=producto.id) }}"
                                    method="post" class="inline"
                                    onsubmit="return confirm('¿Estás seguro de eliminar {{ producto.modelo }}?');">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button
                                        class="p-2 rounded-lg hover:bg-red-900/20 text-canvas-400 hover:text-red-400 transition-colors"
                                        type="submit" title="Eliminar">
                                        <span class="material-symbols-outlined text-[20px]">delete</span>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-canvas-500">
                            <span class="material-symbols-outlined text-4xl mb-2 opacity-50">inventory_2</span>
                            <p>No hay productos que coincidan con la búsqueda.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>
{% endblock %}