{% extends "base.html" %}
{% block title %}Productos{% endblock %}

{% block content %}
<main class="container py-4">
    <div class="d-flex align-items-center mb-4">
        <a class="back-btn" href="{{ url_for('inventario.menu_cliente') }}" aria-label="Volver al menú del cliente">
            <span class="material-symbols-outlined">arrow_back</span>
        </a>
        <h1 class="ms-3 titlewhiteN mb-0">Catálogo</h1>
    </div>

    <form class="glass p-3 mb-4" method="get">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label titlewhite">Buscar</label>
                <input type="text" name="q" class="form-control" placeholder="Modelo / referencia" value="{{ filtros.q }}">
            </div>
            <div class="col-md-3">
                <label class="form-label titlewhite">Tipo</label>
                <input type="text" name="tipo" class="form-control" value="{{ filtros.tipo }}">
            </div>
            <div class="col-md-3">
                <label class="form-label titlewhite">Marca</label>
                <input type="text" name="marca" class="form-control" value="{{ filtros.marca }}">
            </div>
            <div class="col-md-2">
                <label class="form-label titlewhite">Stock</label>
                {% set s = filtros.stock %}
                <select name="stock" class="form-select">
                    <option value="todos" {% if s=='todos' %}selected{% endif %}>Todos</option>
                    <option value="disponible" {% if s=='disponible' %}selected{% endif %}>Disponible</option>
                    <option value="bajo" {% if s=='bajo' %}selected{% endif %}>Stock bajo</option>
                    <option value="sin" {% if s=='sin' %}selected{% endif %}>Sin stock</option>
                </select>
            </div>
            <div class="col-md-2 d-grid">
                <button class="cta" type="submit">Filtrar</button>
            </div>
        </div>
    </form>

    {% if alertas %}
    <div class="alert alert-warning mb-4">
        <h4 class="alert-heading">Productos que necesitan reposición:</h4>
        <ul class="mb-0">
            {% for producto in alertas %}
            <li>{{ producto.tipo_producto }} - {{ producto.marca }} {{ producto.modelo }} (Cantidad disponible: {{ producto.cantidad }})</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="glass-container">
        <div class="table-responsive">
            <table class="glass-table w-100 text-center">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>Descripción</th>
                        <th>Precio</th>
                        <th>Cantidad disponible</th>
                        <th>Agregar a la cesta</th>
                    </tr>
                </thead>
                <tbody>
                    {% for producto in productos %}
                    <tr>
                        <td>{{ producto.tipo_producto }}</td>
                        <td>{{ producto.marca }}</td>
                        <td>{{ producto.modelo }}</td>
                        <td>{{ producto.descripcion }}</td>
                        <td>{{ producto.precio | currency }}</td>
                        <td>{{ producto.cantidad }}</td>
                        <td>
                            <form class="d-flex gap-2 justify-content-center align-items-center"
                                action="{{ url_for('inventario.agregar_a_la_cesta', producto_id=producto.id) }}"
                                method="post">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="number" name="cantidad" value="1" min="1" max="{{ producto.cantidad }}"
                                    class="form-control text-center" style="width: 80px;" aria-label="Cantidad para {{ producto.modelo }}">
                                <button type="submit" class="cta cta-inline" style="padding: 8px 16px; font-size: 0.9rem;">Añadir</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap gap-2">
            <div class="pagination">
                {% if pagination.has_prev %}
                <a class="btn btn-outline-light btn-sm" href="{{ url_for('inventario.productos_cliente', page=pagination.prev_num, **filtros) }}">&larr; Anterior</a>
                {% endif %}
                <span class="text-muted">Página {{ pagination.page }} de {{ pagination.pages }}</span>
                {% if pagination.has_next %}
                <a class="btn btn-outline-light btn-sm" href="{{ url_for('inventario.productos_cliente', page=pagination.next_num, **filtros) }}">Siguiente &rarr;</a>
                {% endif %}
            </div>
        </div>
    </div>
</main>
{% endblock %}
